events {}

http {
    server {
        listen 80;
        server_name localhost 127.0.0.1;

        # Route to React app for frontend (root and /app/*)
        location / {
            proxy_pass http://react_app:3000;
            proxy_set_header Host $host;
        }

        # Explicitly handle React app routes (e.g., /app/*)
        location /app/ {
            proxy_pass http://react_app:3000;
            proxy_set_header Host $host;
            try_files $uri $uri/ /index.html; # Support React client-side routing
        }

        # Route to Django API for /api/*
        location /api/ {
            proxy_pass http://django_app:8000;
            proxy_set_header Host $host;
        }
        
        location /core/ {
            proxy_pass http://django_app:8000;
            proxy_set_header Host $host;
        }
    }
}


# events {}

# http {
#     server {
#         listen 80;
#         server_name localhost 127.0.0.1;

#         # Serve React app for frontend routes
#         location / {
#             proxy_pass http://react_app:3000;
#             proxy_set_header Host $host;
#             proxy_set_header X-Real-IP $remote_addr;
#             proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
#             proxy_set_header X-Forwarded-Proto $scheme;
#         }

#         # Serve specific React app routes (e.g., /app/*)
#         location /app/ {
#             proxy_pass http://react_app:3000;
#             proxy_set_header Host $host;
#             proxy_set_header X-Real-IP $remote_addr;
#             proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
#             proxy_set_header X-Forwarded-Proto $scheme;
#             try_files $uri $uri/ /index.html; # Support React client-side routing
#         }

#         # Serve Django API for /api/* routes
#         location /api/ {
#             proxy_pass http://django_app:8000;
#             proxy_set_header Host $host;
#             proxy_set_header X-Real-IP $remote_addr;
#             proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
#             proxy_set_header X-Forwarded-Proto $scheme;
#         }
#         location /core/ {
#             proxy_pass http://django_app:8000;
#             proxy_set_header Host $host;
#             proxy_set_header X-Real-IP $remote_addr;
#             proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
#             proxy_set_header X-Forwarded-Proto $scheme;
#         }

#         # Serve static files for Django (if needed)
#         location /static/ {
#             alias /app/static/;
#         }

#         # Serve media files for Django (if needed)
#         location /media/ {
#             alias /app/media/;
#         }
#     }
# }